version: 1
backend:
  phases:
    build:
      commands:
        - "# Execute Amplify CLI with the helper script"
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        # Verificar versión actual
        - echo "Current Node version:"
        - node --version
        - echo "Current NPM version:"
        - npm --version

        # Instalar Node 20 usando n (node version manager)
        - npm install -g n
        - n 20
        - hash -r

        # Verificar nueva versión
        - echo "New Node version:"
        - node --version
        - npm --version

        # Actualizar npm a la última versión
        - npm install -g npm@latest

        # Limpiar caché
        - npm cache clean --force

        # Instalar dependencias globales
        - npm install -g @ionic/cli

        # Instalar dependencias del proyecto
        - npm ci

    build:
      commands:
        # Verificar que seguimos usando Node 20
        - node --version
        # Construir el proyecto
        - npm run build

    postBuild:
      commands:
        - echo "Build completed with Node $(node --version)"

  artifacts:
    baseDirectory: dist
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
      - .ionic/**/*
